## 캐시메모리(Cache Memory)

캐시 메모리는 컴퓨터 시스템의 주요 구성 요소 중 하나이며, 주 메모리와 CPU간의 데이터 및 명령어를 효율적으로 관리하기 위한 작은 고속 메모리이다.

### 계층 구조

캐시 메모리는 게층 구조로 구성된다. 일반적으로 L1, L2, L3와 같은 여러 레벨의 캐시가 CPU에 내장된다. L1 캐시는 CPU에 가장 가깝고 가장 빠른 용량을 가지고 있으며, L2,L3는 용량이 더 크지만 L1보다는 느리다.

![](https://velog.velcdn.com/images/dmstjdhdh/post/5de03240-07f1-464a-8f65-2f2ef122c130/image.png)


### 캐싱의 원리

캐시 메모리는 데이터의 지역성 원리를 활용한다.
'자주 참조되는 데이터'에 대한 판단은 '지역성의 원리'를 따르며, 이 지역성을 두 가지 유형으로 구분한다.

>시간 지역성 : 최근 접근한 데이터가 다시 접근할 가능성이 높다.
공간 지역성 : 접근한 데이터에 가까운 주소에 접근할 가능성이 높다.

이러한 아이디어를 이용해서, 캐시 메모리는 데이터를 미리 캐시 메모리에 저장하여 나중에 더 빠르게 액세스할 수 있다.

### 캐시 교체 알고리즘

캐시 메모리는 제한된 용량을 가지고 있기 때문에, 새로운 데이터를 이전 데이터와 교체할 때, 다양한 교체 알고리즘을 사용한다.

#### LRU (Least Recently Used)
- LRU 알고리즘은 가장 오랫동안 참조되지 않은 데이터를 교체한다.
-캐시에 있는 모든 데이터에 "사용 순서"를 부여하고, 가장 오랫동안 사용되지 않은 데이터를 교체한다.

#### FIFO(First-In_First-Out)
- FIFO 알고리즘은 가장 먼저 캐시에 들어온 데이터를 교체한다.
- 데이터가 캐시에 들어온 순서대로 교체하므로, 오래된 데이터가 교체 대상이 된다.

#### 랜덤(Random)
- 랜덤 알고리즘은 캐시에서 교체할 데이터를 무작위로 선택한다.
- 예측성이 없어서 성능이 일관적이진 않지만, 특수 상황에서 우수성을 보여줄 수 있다.


### 캐시 블록

캐시 블록은 캐시 메모리의 작은 저장 단위이다. 캐시는 데이터 및 명령어를 블록 단위로 저장하며, 각 블록은 일반적으로 여러 개의 연속된 바이트를 포함한다. 캐시 블록은 일반적으로 다음과 같은 구성요소를 지닌다.

#### 데이터
캐시 블록에는 주요 데이터가 저장된다.
#### 주소 태그(Address Tag)
주소 태그는 캐시 블록에 저장된 데이터가 어떤 주 메모리 주소 범위에 해당하는지 식별하는 데에 사용한다. CPU가 메모리 주소를 요청할 때, 캐시에서 해당 주소의 태그를 비교하여, 필요한 데이터가 캐시 블록에 있는지 판단한다.

#### 유효성 비트 (Valid Bit)
유효성 비트는 해당 캐시 블록에 유효한 데이터가 저장되어 있는지 여부를 나타내는 데 사용한다.

#### 변경 비트 (Dirty Bit 또는 Modified Bit)
변경 비트는 캐시 블록에 저장된 데이터가 변경되었는지 여부를 나타내는 데 사용된다. 만약 데이터가 수정되었다면, 변경 비트가 설정되어 있고 이후 주 메모리를 다시 기록해야한다.

#### LRU 정보
이 정보는 캐시 블록이 언제 사용되었는지 추적하는 데 사용된다. 아까 언급한 LRU 알고리즘에서 사용된다.

#### 데이터 크기 및 블록 인덱스

각 캐시 블록은 일반적으로 고정된 크기의 데이터를 저장하며, 블록 크기와 인덱스는 캐시의 구조를 결정한다.

참조 지역성의 원리로 인해서 데이터 접근이 빠른 캐시의 성능에 더불어서 캐시 블록의 구성요소중에, 유효성 비트와 태그의 존재로 인해서, 메모리 접근이 유용해진다.


### 캐시 히트와 캐시 미스

#### 캐시 히트(Cache Hit)
- 캐시 히트는 CPU가 데이터 또는 명령어를 요청했을 때, 해당 데이터가 이미 캐시 메모리에 존재하고 사용 가능한 상태인 경우 발생한다.
- 이 경우, 데이터 액세스가 빠르게 처리된다.
- 캐시 히트를 최대화하면 CPU 성능을 향상시키고 주 메모리 액세스를 줄일 수 있다.

#### 캐시 미스(Cache Miss)
- 캐시 미스는 CPU가 데이터를 요청했을 때, 해당 데이터가 캐시 메모리에 없거나 유효하지 않은 상태일 때 발생한다.
- 캐시 미스가 발생하면 CPU는 주 메모리로부터 필요한 데이터를 읽어와 캐시로 복사하거나, 쓰기 연산의 경우 주 메모리로 데이터를 기록한다. 이는 더 많은 시간과 에너지를 소비한다.
- 캐시 미스를 최소화하기 위해서는, 적절한 캐시 크기, 알고리즘, 데이터 지역성을 고려해야한다.

> 캐시 히트와 캐시 미스는 컴퓨터 아키텍쳐와 성능 최적화에 중요한 역할을 한다.